---
date: 0200-01-16
category: examples
layout: examples
title: Key frame animation on a marker
rotation: horizontal
description: Animating a custom marker with a key frame animation.
type: gif
tags:
  - marker
  - point
  - pin
  - callout
  - popup
  - animation
  - CAKeyframeAnimation
notes: You will have to make a png sequence for this project.
---
@interface MyViewController () <RMMapViewDelegate>

@end

@implementation MyViewController

- (void)viewDidLoad
{
    [super viewDidLoad];

    [[RMConfiguration sharedInstance] setAccessToken:@"<access token>"];

    RMMapboxSource *tileSource = [[RMMapboxSource alloc] 
                                      initWithMapID:@"mapbox.run-bike-hike"];
    
    RMMapView *mapView = [[RMMapView alloc] initWithFrame:self.view.bounds 
                                                  andTilesource:tileSource];
    
    mapView.delegate = self;
    
    [self.view addSubview:mapView];
    
    // build first marker and title
    RMAnnotation *annotation1 = [[RMAnnotation alloc]
                                 initWithMapView:mapView
                                 coordinate:CLLocationCoordinate2DMake(38.894368, 
                                                                      -77.036487)
                                 andTitle:@"Astronaut training"];

    annotation1.userInfo = @"training";
    [mapView addAnnotation:annotation1];

    
    // you will need to add a <RMMapViewDelegate> to the ViewController.h file
    mapView.delegate = self;
    
    // set coordinates
    CLLocationCoordinate2D center = CLLocationCoordinate2DMake(38.894368, 
                                                              -77.036487);
    
    // set zoom
    mapView.zoom = 17;
    
    // center the map to the coordinates
    mapView.centerCoordinate = center;
    
    // allows rotation
    mapView.autoresizingMask = UIViewAutoresizingFlexibleHeight |
    UIViewAutoresizingFlexibleWidth;

}

- (RMMapLayer *)mapView:(RMMapView *)mapView layerForAnnotation:(RMAnnotation *)annotation
{
    if (annotation.isUserLocationAnnotation)
        return nil;
    
    RMMarker *marker;
    
    marker = [[RMMarker alloc] initWithUIImage:[UIImage imageNamed:@"astronaut.png"]];

    marker.canShowCallout = YES;
    marker.bounds = CGRectMake(0, 0, 100, 143);
    
    CAKeyframeAnimation *animation = [CAKeyframeAnimation animationWithKeyPath:@"contents"];
    
    // Each keyframe value is used in turn, no interpolated values are calculated.
    [animation setCalculationMode:kCAAnimationDiscrete];

    // animation will take 2 seconds
    [animation setDuration:2.0f];
    
    //Setting this property to HUGE_VALF will cause the animation to repeat forever.
    [animation setRepeatCount:HUGE_VALF];
    
    // Creating a mutable array for our png sequence
    NSMutableArray *frameValues = [NSMutableArray array];
    
    for (NSUInteger i = 0; i < 40; i++)
    {
        // if i is smaller than 10, our image name will need 4 times 0: astronaut_00000.png,
        // astronaut_00000.png, astronaut_00002.png,...
        // if i is bigger or equal to 10, our image name will need 3 times 0: astronaut_00010.png,
        // astronaut_00011.png, astronaut_00012.png,...
        NSString *frameName = [NSString stringWithFormat:@"astronaut_000%@%lu.png",
                                           (i < 10 ? @"0" : @""), (unsigned long)i];
                                           
        [frameValues addObject:(id)[[UIImage imageNamed:frameName] CGImage]];
    }
    
    [animation setValues:frameValues];
    
    //Add the animation to the layer
    [marker addAnimation:animation forKey:@"contents"];
    
    [marker setFrame:CGRectMake(0, 0, 150, 150)];
    
    return marker;
}

